<div layout="row" layout-align="start end" class="_chat-overlay-wrapper">
    <div ng-repeat="conversation_rec in overlay.conversations">
        <div class="_chat-overlay md-whiteframe-z1" ng-class="{'_minimized': conversation_rec.status == overlay.status.MINIMIZED}">
            <div ng-cloak="" class="_chat-header" ng-class="{'_active': conversation_rec.isExpanded}"
                 ng-click="overlay.toggle(null, $event, conversation_rec)">
                <md-icon class="_icon" md-font-set="material-icons">chat</md-icon>
                <span class="_user">{{ conversation_rec.conversation.recipient_names[0] }}</span>
                <md-icon ng-click="overlay.closeConversation($event, conversation_rec)"
                         class="_toggle _icon-18" md-font-set="material-icons">
                    {{ overlay.getIcon(conversation_rec) }}</md-icon>
            </div>
            <div class="_chat-body layout-column {{ '_c'+conversation_rec.id }}" ng-show="conversation_rec.isExpanded">
                <div class="_overlay-messages">
                    <div class="_no-messages" ng-cloak=""
                         ng-if="!overlay.loading && !conversation_rec.conversation.messages.length"> There are no
                        messages yet
                    </div>
                    <div class="_scroll">
                        <div class="_message-wrapper" ng-repeat="message in conversation_rec.conversation.messages">
                            <div class="_message _overlay"
                                 ng-class="{'_mine': message.is_self, '_last': $last, '_other': !message.is_self}">
                                <span>{{ message.body }}</span>
                                <span class="_time-stamp">{{ message.time_relative }}</span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="_overlay-input-wrapper">
                    <md-input-container md-no-float class="md-block">
                <textarea md-enter="overlay.sendMessage(conversation_rec)" class="_message-input _overlay-input"
                          ng-model="conversation_rec.newMessage"
                          placeholder="Type a message ..."></textarea>
                    </md-input-container>
                </div>
            </div>

        </div>
    </div>

</div>
